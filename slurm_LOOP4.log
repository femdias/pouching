
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      18.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: 5-user 8-core network perpetual
Serial number: 501806372583
  Licensed to: Econ Department
               Cornell University, Ithaca, NY

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do master_LOOP4.do /logs/slurm_LOOP4.log 

. // Poaching Project
. // Created by: Fabiano Dal-Ri
. // (fd237@cornell.edu; dalri.fabiano@gmail.com)
. // Date created: April 2024
. 
. // Purpose: Master file for the "Poaching" project
. 
. *--------------------------*
. * SET UP
. *--------------------------*
. 
.         // working directory
.         cd "/home/ecco_rais/data/interwrk/daniela_group"
/home/ecco_rais/data/interwrk/daniela_group

.         
.         // clearing session
.         clear all

.         macro drop _all

. 
.         // default color scheme
.         set scheme s1color

.         
.         // globals -- input files
.         
.         global RAIS_Clean       "RAIS/output/data/identified/RAIS_Clean"

.         global AKM              "akm/output/data"

.         global JointMovements   "displacement/output/data/JointMovements"

.         global Owners           "fabiano/jmp/output/data/Owners"

.         global Firms_Panel      "fabiano/jmp/output/data/Firms_Panel"   

.         
.         // globals -- paths in this folder
.         
.         global input            "poaching/input"

.         global prepare          "poaching/programs/prepare"

.         global analysis         "poaching/programs/analysis"

.         global auxiliary        "poaching/programs/auxiliary"

.         global data             "poaching/output/data"

.         global results          "poaching/output/results"

.         global temp             "poaching/temp"

.         
.         // globals -- analysis
.         
.         global evt_vars evt_l9 evt_l8 evt_l7 evt_l6 evt_l5 evt_l4 evt_zero ev
> t_l2 evt_l1 ///
>               evt_f0 evt_f1 evt_f2 evt_f3 evt_f4 evt_f5 evt_f6 evt_f7 evt_f8 
> evt_f9 evt_f10 evt_f11 evt_f12     

.         
. *-----------------------------------------*
. * POPULATING INPUT FOLDER
. *-----------------------------------------*
. 
.         // "auxiliary" folder:
.         // -- ipca_brazil.dta: taken from other projects; no raw files availa
> ble anymore
.         // -- minwage_brazil.dta: taken from other projects; no raw files ava
> ilable anymore
.         // -- georegions.dta: taken from Fabiano's JMP
.         
. *-----------------------------------------*
. * PREPARE
. *-----------------------------------------*
. 
. // PART I: organizing RAIS data 
. 
.         // create a monthly RAIS panel
.         *do "${prepare}/rais_m"
.         
. // PART II: constructing auxiliary data sets
. 
.         // calculate average number of employees
.         *do "${prepare}/plantsize_m"
.         
.         // calculate wage growth variables at the plant-level
.         *do "${prepare}/wagegrowth_m"
.         
.         // calculate industry growth (employment)
.         *do "${prepare}/industrygrowth_m" // IN PROGRESS
.         
.         // calculate positive employment dummy variable
.         *do "${prepare}/posemp_m"
.                         
.         // identify joing movements
.         *do "${prepare}/jointmvt"
. 
. // PART III: constructing intermediate data sets
. 
.         // identifying poaching events
.         *do "${prepare}/202503_evt_m"
.         
.         // constructing worker-level panel with coworkers of the poached indi
> viduals
.         *do "${prepare}/202503_cowork_panel_m"
.         *do "${prepare}/202503_cowork_panel_m_LOOP1"
.         *do "${prepare}/202503_cowork_panel_m_LOOP2"
.         *do "${prepare}/202503_cowork_panel_m_LOOP3"
.         do "${prepare}/202503_cowork_panel_m_LOOP4"

. // Poaching Project
. // Created by: Fabiano Dal-Ri
. // (fd237@cornell.edu; dalri.fabiano@gmail.com)
. // Date created: May 2024
. 
. // Purpose: Constructing the panel with coworkers
. 
. *--------------------------*
. * BUILD
. *--------------------------*
. 
. /*
> 
> // PART I: LIST ORIGIN AND DESTINATION PLANTS, ALONG WITH MONTHS OF INTEREST
> 
>         // this panel will be constructed separately for each cohort
>         foreach ym of numlist 601/611 613/623 625/635 637/647 649/659 661/671
>  673/683 { 
>                         
>         use "${data}/202503_evt_m", clear
>         
>         // let's only keep the unique event identifiers
>         keep eventid d_plant o_plant pc_ym
>         egen unique = tag(eventid)
>         keep if unique == 1
> 
>         // keep the cohort we're looping over           
>         keep if pc_ym == `ym'
>         
>                 // origin plants
>                 
>                 preserve
>                 
>                         keep eventid o_plant pc_ym
>                         rename o_plant plant_id
>                         compress
>                         save "${temp}/202503_o_plant_`ym'", replace
>         
>                 restore
>         
>                 // destination plants
>                 
>                 preserve
>                 
>                         keep eventid d_plant pc_ym
>                         rename d_plant plant_id
>                         compress
>                         save "${temp}/202503_d_plant_`ym'", replace
>                         
>                 restore
>                 
>         clear
>         
>         }
>         
> // PART II: LISTING COWORKERS AND FINDING THEM
>         
>         // this panel will be constructed separately for each cohort
>         foreach ym of numlist 601/611 613/623 625/635 637/647 649/659 661/671
>  673/683 {
>         
>         // origin coworkers
>                 
>                 local o_ym = `ym'-12 // origin coworkers are identified 12 mo
> nths before the event
>                 
>                 use "${data}/rais_m/rais_m`o_ym'", clear
>                 
>                 merge m:1 plant_id using "${temp}/202503_o_plant_`ym'"
>                 keep if _merge == 3
>                 drop _merge
>                 
>                 keep cpf eventid pc_ym 
>                 
>                 compress
>                 save "${temp}/202503_o_cw_`ym'", replace
>                 
>         // destination coworkers
>         
>                 local d_ym = `ym' // destination coworkers are identified at 
> the time of the event
>                 
>                 use "${data}/rais_m/rais_m`d_ym'", clear
>                 
>                 merge m:1 plant_id using "${temp}/202503_d_plant_`ym'"
>                 keep if _merge == 3
>                 drop _merge
>                 
>                 keep cpf eventid pc_ym
>                 
>                 compress
>                 save "${temp}/202503_d_cw_`ym'", replace
>                 
>         // finding these workers in monthly RAIS files  
> 
>         local ym_l12 = `ym' - 12
>         local ym_f12 = `ym' + 12
> 
>         // origin coworkers
>         
>         forvalues yymm=`ym_l12'/`ym_f12' {
>                 
>                 use "${data}/rais_m/rais_m`yymm'", clear
>                 
>                 drop year month firm_id hire_year hire_month hire_day occ_1d 
> occ_3d ///
>                         sep_month contract_salary salary_type legal_nature cn
> ae20_subclass
>                 
>                 merge 1:1 cpf using "${temp}/202503_o_cw_`ym'"
>                 keep if _merge == 3
>                 drop _merge
>                 
>                 compress
>                 save "${temp}/202503_o_cw_`ym'_`yymm'", replace
>                 
>         }
>         
>         // destination coworkers
>         
>         forvalues yymm=`ym_l12'/`ym_f12' {
>                 
>                 use "${data}/rais_m/rais_m`yymm'", clear
>                 
>                 drop year month firm_id hire_year hire_month hire_day occ_1d 
> occ_3d ///
>                         sep_month contract_salary salary_type legal_nature cn
> ae20_subclass
>                 
>                 merge 1:1 cpf using "${temp}/202503_d_cw_`ym'"
>                 keep if _merge == 3
>                 drop _merge
>                 
>                 compress
>                 save "${temp}/202503_d_cw_`ym'_`yymm'", replace
>                 
>         }
>         
>         // combining all months in a cohort planel
>                 
>         // origin
>         
>         use "${temp}/202503_o_cw_`ym'", clear
>                         
>                 expand 25
>                 sort cpf
>                         
>                         by cpf: gen ym = pc_ym - 13 + _n
>                         format ym %tm
>                         
>                         gen ym_rel = ym - pc_ym
>                         
>                         local ym_l12 = `ym' - 12
>                         local ym_f12 = `ym' + 12
>                         
>                         forvalues yymm=`ym_l12'/`ym_f12' {
>                         
>                                 merge 1:1 cpf ym using "${temp}/202503_o_cw_`
> ym'_`yymm'", nogen update
> 
>                         }
>         compress
>         save "${temp}/202503_o_cw_`ym'_complete", replace
>         
>                 // removing heavy temporary files
>                 
>                 clear
>                 forvalues yymm=`ym_l12'/`ym_f12' {
>                 rm "${temp}/202503_o_cw_`ym'_`yymm'.dta"
>                 }
>         
>         // destination
>         
>         use "${temp}/202503_d_cw_`ym'", clear
>                         
>                 expand 25
>                 sort cpf
>                         
>                         by cpf: gen ym = pc_ym - 13 + _n
>                         format ym %tm
>                         
>                         gen ym_rel = ym - pc_ym
>                         
>                         local ym_l12 = `ym' - 12
>                         local ym_f12 = `ym' + 12
>                         
>                         forvalues yymm=`ym_l12'/`ym_f12' {
>                         
>                                 merge 1:1 cpf ym using "${temp}/202503_d_cw_`
> ym'_`yymm'", nogen update
> 
>                         }
>         compress
>         save "${temp}/202503_d_cw_`ym'_complete", replace
>         
>                 // removing heavy temporary files
>                 
>                 clear
>                 forvalues yymm=`ym_l12'/`ym_f12' {
>                 rm "${temp}/202503_d_cw_`ym'_`yymm'.dta"
>                 }
>                         
>         }
>         
> // PART III: ORGANIZING AUXILIARY DATA SETS
> 
>         // keeping event level information we need
> 
>                 use "${data}/202503_evt_m", clear
>                 
>                 keep eventid o_plant d_plant d_n_emp_lavg o_n_emp_lavg multip
> le
>                 
>                 // only 1 observation for each event id
>                 egen unique = tag(eventid)
>                 keep if unique == 1
>                 drop unique
>                 
>                 // saving
>                 save "${temp}/202503_evt_vars", replace
>                 
>         // keeping list of poached individuals
>         
>                 use "${data}/202503_evt_m", clear
>                 
>                 drop if eventid == . // THIS WILL BE CORRECTED SOON!! DELETE 
> THIS LINE THEN!!!
>                 keep eventid pc_cpf pc_dir pc_spv pc_emp pc_d_dir pc_d_spv pc
> _d_emp
>                 rename pc_cpf cpf
>                 
>                 save "${temp}/202503_pc_ind", replace
>         
> // PART IV: ADDING MORE INFORMATION AND VARIABLES WE MIGHT NEED
> 
>         // this panel will be constructed separately for each cohort
>         foreach ym of numlist 601/611 613/623 625/635 637/647 649/659 661/671
>  673/683 {
>         
>         use "${temp}/202503_o_cw_`ym'_complete", clear
>         
>         // event-level information
>         merge m:1 eventid using "${temp}/202503_evt_vars"
>         drop if _merge == 2
>         drop _merge
>                 
>         // wages variables
>                 
>                 // adjusting wages ---- THIS IS ALSO TEMPORARY --- WILL EVENT
> UALLY BE DONE WHEN CONSTRUCTING THE MONTHLY DS
>                 
>                 gen year = year(dofm(ym))
>                 merge m:1 year using "${input}/auxiliary/ipca_brazil"
>                 generate index_2017 = index if year == 2017
>                 egen index_base = max(index_2017)
>                 generate adj_index = index / index_base
>                 drop if _merge == 2
>                                 
>                         // in level
>                         generate wage_real = earn_avg_month_nom / adj_index
>                 
>                         // in logs
>                         gen wage_real_ln = ln(wage_real)
>                         
>                 drop year index _merge index_2017 index_base adj_index
>                 
>                 // other wage variables
>                 
>                 // wage in t=-12, level
>                 
>                 gen wage_real_l12_temp = wage_real if ym_rel == -12
>                 egen wage_real_l12 = max(wage_real_l12_temp), by(cpf)
>                 
>                 drop wage_real_l12_temp
>                 
>                 // wage in t=-12, log
>                 
>                 gen wage_real_ln_l12_temp = wage_real_ln if ym_rel == -12
>                 egen wage_real_ln_l12 = max(wage_real_ln_l12_temp), by(cpf)
>                 
>                 drop wage_real_ln_l12_temp
>                         
>                 // wage in t=0, level
>                 
>                 gen wage_real_0_temp = wage_real if ym_rel == 0
>                 egen wage_real_0 = max(wage_real_0_temp), by(cpf)
>                 
>                 drop wage_real_0_temp
>                 
>                 // wage in t=0, log
>                 
>                 gen wage_real_ln_0_temp = wage_real_ln if ym_rel == 0
>                 egen wage_real_ln_0 = max(wage_real_ln_0_temp), by(cpf)
>                 
>                 drop wage_real_ln_0_temp                
>                                 
>         // identifying the poached individuals among the coworkers
>         
>         merge m:1 eventid cpf using "${temp}/202503_pc_ind"
>         drop if _merge == 2
>         drop _merge
>         
>                 // organzing the newly added variables
>                 replace pc_dir = 0 if pc_dir == .
>                 replace pc_spv = 0 if pc_spv == .
>                 replace pc_emp = 0 if pc_emp == .
>                 replace pc_d_dir = 0 if pc_d_dir == .
>                 replace pc_d_spv = 0 if pc_d_spv == .
>                 replace pc_d_emp = 0 if pc_d_emp == .
>                 
>                 // unique variable identifying the poached individuals
>                 gen pc_individual = (pc_dir == 1 | pc_spv == 1 | pc_emp == 1)
>                 
>         // identify the raided individuals among the coworkers  
>         
>                 // set hiring year-month
>                 gen hire_ym = ym(year(hire_date), month(hire_date))
>                 format hire_ym %tm
>                                 
>                         // identify raiding events
>                         
>                         gen raid = ((ym == hire_ym) & (hire_ym != .)) /// hir
> ed in the month
>                                    & (plant_id == d_plant) /// moving to dest
> ination plant
>                                    & (pc_individual == 0) // not a poached in
> dividual 
>                                  
>                                 // let's identify who was raided more than on
> ce
>                                 egen raid_n = sum(raid), by(cpf)
>                                 gen raid_multiple = (raid_n > 1)
>                                 drop raid_n
>                                  
>                                 // if an individual is raided more than once,
>  use only the first raiding
>                                 gen ym_raid = ym if raid == 1
>                                 egen ym_raid_min = min(ym_raid), by(cpf)
>                                 replace raid = 0 if ym_raid != ym_raid_min
>                                 drop ym_raid ym_raid_min
>                                 
>                         // raid types according to occupations
>                         
>                                 // spv in origin
>                                 
>                                 gen spv_l12_temp = spv if ym_rel == -12
>                                 egen spv_l12 = max(spv_l12_temp), by(cpf)
>                                 
>                                 gen raid_spv_temp = (raid == 1 & spv_l12 == 1
> )
>                                 egen raid_spv = max(raid_spv_temp), by(cpf)
>                                 
>                                 drop spv_l12_temp raid_spv_temp
>                                 
>                                 // dir in origin
>                                 
>                                 gen dir_l12_temp = dir if ym_rel == -12
>                                 egen dir_l12 = max(dir_l12_temp), by(cpf)
>                                 
>                                 gen raid_dir_temp = (raid == 1 & dir_l12 == 1
> )
>                                 egen raid_dir = max(raid_dir_temp), by(cpf)
>                                 
>                                 drop dir_l12_temp raid_dir_temp
>                                 
>                                 // emp in origin
>                                 
>                                 gen emp = (dir == 0 & spv == 0) // THIS SHOUL
> D BE CREATED WAY BEFORE!!!!!!!
>                                 
>                                 gen emp_l12_temp = emp if ym_rel == -12
>                                 egen emp_l12 = max(emp_l12_temp), by(cpf)
>                                 
>                                 gen raid_emp_temp = (raid == 1 & emp_l12 == 1
> )
>                                 egen raid_emp = max(raid_emp_temp), by(cpf)
>                                 
>                                 drop emp_l12_temp raid_emp_temp
>                                 
>                                 // spv in destination
>                                 
>                                 gen raid_d_spv_temp = (raid == 1 & spv == 1)
>                                 egen raid_d_spv = max(raid_d_spv_temp), by(cp
> f)
>                                 
>                                 drop raid_d_spv_temp
>                                 
>                                 // dir in destination
>                                 
>                                 gen raid_d_dir_temp = (raid == 1 & dir == 1)
>                                 egen raid_d_dir = max(raid_d_dir_temp), by(cp
> f)
>                                 
>                                 drop raid_d_dir_temp
>                                 
>                                 // emp in destination
>                                 
>                                 gen raid_d_emp_temp = (raid == 1 & emp == 1)
>                                 egen raid_d_emp = max(raid_d_emp_temp), by(cp
> f)
>                                 
>                                 drop raid_d_emp_temp
>                                 
>                         // identify raided individuals
>                         egen raid_individual = max(raid), by(cpf)
>                         
>         // saving
>         compress
>         save "${temp}/202503_o_cw_`ym'_complete", replace
>         
>         }       
>         
>         
> */      
.         
.                         // CONTINUAR RODANDO A PARTIR DAQUI
.         
. // PART V: ADDING FIXED EFFECTS
. 
.         // this panel will be constructed separately for each cohort
.         *foreach ym of numlist 601/611 613/623 625/635 637/647 649/659 661/67
> 1 673/683 { // ALL EVENTS
.         *foreach ym of numlist 601/611  { // LOOP 1
.         *foreach ym of numlist 613/623  { // LOOP 2
.         *foreach ym of numlist 625/635  { // LOOP 3
.         foreach ym of numlist 637/647  { // LOOP 4
  2.         *foreach ym of numlist 649/659  { // LOOP 5
.         *foreach ym of numlist 661/671  { // LOOP 6
.         *foreach ym of numlist 673/683  { // LOOP 7
.         
.         use "${temp}/202503_o_cw_`ym'_complete", clear
  3.         
.                 // worker FE
.                 merge m:1 cpf using "${AKM}/AKM_2003_2008_both_workerFE", kee
> p(master match) nogen
  4.                 rename naive_FE_worker worker_naive_fe
  5.                 rename akm_FE_worker worker_akm_fe
  6.                 
.                 // firm FE
.                 tostring plant_id, generate(plant_id_str) format(%014.0f)
  7.                 gen firm_id = substr(plant_id_str, 1, 8)
  8.                 destring firm_id, replace force
  9.                 merge m:1 firm_id using "${AKM}/AKM_2003_2008_both_firmFE"
> , keep(master match) nogen
 10.                 rename naive_FE_firm firm_naive_fe
 11.                 rename akm_FE_firm firm_akm_fe
 12.                 drop plant_id_str firm_id
 13.                 
.                 // origin firm FE
.                 tostring o_plant, generate(o_plant_str) format(%014.0f)
 14.                 gen firm_id = substr(o_plant_str, 1, 8)
 15.                 destring firm_id, replace force
 16.                 merge m:1 firm_id using "${AKM}/AKM_2003_2008_both_firmFE"
> , keep(master match) nogen
 17.                 rename naive_FE_firm o_firm_naive_fe
 18.                 rename akm_FE_firm o_firm_akm_fe
 19.                 drop o_plant_str firm_id
 20.                 
.                 // destination firm FE
.                 tostring d_plant, generate(d_plant_str) format(%014.0f)
 21.                 gen firm_id = substr(d_plant_str, 1, 8)
 22.                 destring firm_id, replace force
 23.                 merge m:1 firm_id using "${AKM}/AKM_2003_2008_both_firmFE"
> , keep(master match) nogen
 24.                 rename naive_FE_firm d_firm_naive_fe
 25.                 rename akm_FE_firm d_firm_akm_fe
 26.                 drop d_plant_str firm_id
 27.         
.         // saving
.         compress
 28.         save "${temp}/202503_o_cw_`ym'_complete", replace
 29.         
.                                         timer off 1
 30.                                         
.                                         timer list
 31.                                         
.         }       

    Result                      Number of obs
    -----------------------------------------
    Not matched                    21,268,400
        from master                21,268,400  
        from using                          0  

    Matched                        45,258,900  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(12044311 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    16,153,767
        from master                16,153,767  
        from using                          0  

    Matched                        50,373,533  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     2,912,025
        from master                 2,912,025  
        from using                          0  

    Matched                        63,615,275  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     5,356,875
        from master                 5,356,875  
        from using                          0  

    Matched                        61,170,425  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_637_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    23,167,350
        from master                23,167,350  
        from using                          0  

    Matched                        47,602,900  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(12854881 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    17,059,073
        from master                17,059,073  
        from using                          0  

    Matched                        53,711,177  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     2,855,575
        from master                 2,855,575  
        from using                          0  

    Matched                        67,914,675  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     7,214,000
        from master                 7,214,000  
        from using                          0  

    Matched                        63,556,250  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_638_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    24,664,675
        from master                24,664,675  
        from using                          0  

    Matched                        50,882,200  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(13563778 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    18,216,730
        from master                18,216,730  
        from using                          0  

    Matched                        57,330,145  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     3,396,825
        from master                 3,396,825  
        from using                          0  

    Matched                        72,150,050  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     7,176,175
        from master                 7,176,175  
        from using                          0  

    Matched                        68,370,700  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_639_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    23,971,125
        from master                23,971,125  
        from using                          0  

    Matched                        49,027,325  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(13081886 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    17,837,874
        from master                17,837,874  
        from using                          0  

    Matched                        55,160,576  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     3,548,825
        from master                 3,548,825  
        from using                          0  

    Matched                        69,449,625  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     7,585,750
        from master                 7,585,750  
        from using                          0  

    Matched                        65,412,700  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_640_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    23,525,550
        from master                23,525,550  
        from using                          0  

    Matched                        47,465,750  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(12708438 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    16,772,246
        from master                16,772,246  
        from using                          0  

    Matched                        54,219,054  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     2,682,750
        from master                 2,682,750  
        from using                          0  

    Matched                        68,308,550  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     8,250,575
        from master                 8,250,575  
        from using                          0  

    Matched                        62,740,725  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_641_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    23,736,700
        from master                23,736,700  
        from using                          0  

    Matched                        47,092,725  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(12909376 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    17,367,105
        from master                17,367,105  
        from using                          0  

    Matched                        53,462,320  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     3,336,125
        from master                 3,336,125  
        from using                          0  

    Matched                        67,493,300  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     7,905,750
        from master                 7,905,750  
        from using                          0  

    Matched                        62,923,675  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_642_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    24,166,700
        from master                24,166,700  
        from using                          0  

    Matched                        47,054,550  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(12884356 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    17,744,366
        from master                17,744,366  
        from using                          0  

    Matched                        53,476,884  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     3,967,400
        from master                 3,967,400  
        from using                          0  

    Matched                        67,253,850  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     7,670,425
        from master                 7,670,425  
        from using                          0  

    Matched                        63,550,825  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_643_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    22,934,475
        from master                22,934,475  
        from using                          0  

    Matched                        45,240,275  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(12367825 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    17,039,508
        from master                17,039,508  
        from using                          0  

    Matched                        51,135,242  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     3,726,775
        from master                 3,726,775  
        from using                          0  

    Matched                        64,447,975  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     7,892,700
        from master                 7,892,700  
        from using                          0  

    Matched                        60,282,050  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_644_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    25,193,475
        from master                25,193,475  
        from using                          0  

    Matched                        47,912,450  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(13500142 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    18,790,782
        from master                18,790,782  
        from using                          0  

    Matched                        54,315,143  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     4,527,050
        from master                 4,527,050  
        from using                          0  

    Matched                        68,578,875  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                    10,188,825
        from master                10,188,825  
        from using                          0  

    Matched                        62,917,100  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_645_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    23,694,950
        from master                23,694,950  
        from using                          0  

    Matched                        43,084,850  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(12795672 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    17,788,576
        from master                17,788,576  
        from using                          0  

    Matched                        48,991,224  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     4,115,750
        from master                 4,115,750  
        from using                          0  

    Matched                        62,664,050  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     8,931,450
        from master                 8,931,450  
        from using                          0  

    Matched                        57,848,350  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_646_complete.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                    18,514,500
        from master                18,514,500  
        from using                          0  

    Matched                        35,251,625  
    -----------------------------------------
plant_id_str generated as str14
firm_id: all characters numeric; replaced as long
(9955312 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                    13,867,858
        from master                13,867,858  
        from using                          0  

    Matched                        39,898,267  
    -----------------------------------------
o_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     3,145,700
        from master                 3,145,700  
        from using                          0  

    Matched                        50,620,425  
    -----------------------------------------
d_plant_str generated as str14
firm_id: all characters numeric; replaced as long

    Result                      Number of obs
    -----------------------------------------
    Not matched                     5,972,725
        from master                 5,972,725  
        from using                          0  

    Matched                        47,793,400  
    -----------------------------------------
  (0 bytes saved)
file poaching/temp/202503_o_cw_647_complete.dta saved

.         
.         /*
>         
>         
> // PART V: ADDING VARIABLES INDICATING TENURE OVERLAP OF WORKER WITH POACHED 
> INDIVIDUAL
> 
>         // this panel will be constructed separately for each cohort
>         foreach ym of numlist 601/611 613/623 625/635 637/647 649/659 661/671
>  673/683 {
>                 
>         use "${temp}/202503_o_cw_`ym'_complete", clear  
>                 
>                 if _N > 0 {
> 
>                 // construct variables that indicate tenure overlap
>                 // tenure in RAIS is reported in december or last month of pe
> rson in the firm
>                 // let us compute a "running" tenure instead
>                 gen tenure_ym = ym - hire_ym
>                 
>                 // identify cases we have more than 1 pc individual -- we won
> 't calculate overlap in this case
>                 egen n_pc = sum(pc_individual), by(event_id ym_rel)
> 
>                 // tenure of pc individual expanded to the event
>                 gen tenure_ym_pc_aux = tenure_ym if (ym_rel <= -1 & pc_indivi
> dual == 1)
>                 egen tenure_ym_pc = max(tenure_ym_pc_aux), by(event_id ym_rel
> )
>                 drop tenure_ym_pc_aux
>                 replace tenure_ym_pc = . if n_pc != 1
>                 
>                         // if tenure_ym_pc is smaller than 12 in t=-1, do not
>  calculate this
>                         gen tenure_ym_pc_l1_aux = tenure_ym_pc if ym_rel == -
> 1
>                         egen tenure_ym_pc_l1 = max(tenure_ym_pc_l1_aux), by(e
> vent_id)
>                         replace tenure_ym_pc = . if tenure_ym_pc_l1 < 12
>                         drop tenure_ym_pc_l1_aux tenure_ym_pc_l1
>                         
>                 // tenure overlap in each month
>                 gen tenure_overlap_ym = .
>                 replace tenure_overlap_ym = min(tenure_ym, tenure_ym_pc) ///
>                         if plant_id == o_plant /// worker still employed in o
> rigin plant
>                         & ym_rel <= -1 /// before the poaching event
>                         & pc_individual == 0 // doesn't make sense for poache
> d individuals
>                 replace tenure_overlap_ym = . if n_pc != 1
>                 
>                 // tenure overlap when co-employment terminates
>                 egen tenure_overlap = max(tenure_overlap_ym), by(event_id cpf
> )
>                 
>                 // labeling new variables
>                 label var tenure_ym          "Tenure (in Months)"
>                 label var n_pc               "Number of Poached Individuals i
> n the Event"
>                 label var tenure_ym_pc       "Tenure (in Months) of the Poach
> ed Individual"
>                 label var tenure_overlap_ym  "Cumulative Tenure Overlap (in M
> onths)"
>                 label var tenure_overlap     "Total Tenure Overlap"
>                 
>                 // saving
>                 save "${data}/cowork_panel_m_`e'/cowork_panel_m_`e'_`ym'", re
> place
>                 
>                 }
> 
>         }
>         }
>                 
> *--------------------------*
> * EXIT
> *--------------------------*
> 
> cap rm "${temp}/key_evts_m.dta"
> cap rm "${temp}/o_plants.dta"
> cap rm "${temp}/cw.dta"
> 
> forvalues ym=516/695 {
> 
>         cap rm "${temp}/cw_`ym'.dta"
> 
> }
> 
> clear

end of do-file

.         *do "${prepare}/202503_cowork_panel_m_LOOP5"
.         *do "${prepare}/202503_cowork_panel_m_LOOP6"
.         *do "${prepare}/202503_cowork_panel_m_LOOP7"
.         
.         // constructing event-level panel with poaching plants (destination p
> lants)
.         *do "${prepare}/202503_evt_panel_m"
.         
.         // event-level data set
.         *do "${prepare}/202503_poach_ind"
.         
.         // constructing worker-level data set with poaching firms in t=0
.         *do "${prepare}/dest_panel_m"
.         
.         // identifying event types (using destination occupation)
.         *do "${prepare}/evt_type_m"
.         
.         // imposing sample selection restrictions to the analysis
.         *do "${prepare}/sample_selection"
.         
. // PART IV: constructing main data sets
. 
.         *do "${prepare}/202503_poaching_evt"
. 
. *-----------------------------------------*
. * ANALYSIS (FINAL) - FELIPE: USE THIS
. *-----------------------------------------*
. 
. // MAIN ANALYSIS
. 
.         // imposing restrictions and listing the events we want
.         *do "${analysis}/eventlist"     
.         
.         // exhibits
.         *do "${analysis}/final_sumstats"
.         *do "${analysis}/final_pred1"
.         *do "${analysis}/final_pred2"
.         *do "${analysis}/final_pred3"
.         *do "${analysis}/final_pred4"
.         *do "${analysis}/final_pred5"
.         *do "${analysis}/final_pred6"
.         *do "${analysis}/final_pred7"
.         *do "${analysis}/final_alternatives"
.         
.         // other analyses
.         *do "${analysis}/final_preddelta"
.         
. // TESTING OTHER HYPOTHESES
. 
.         // hypothesis: managers are the owners of the destination firm (spino
> ffs)
.         *do "${analysis}/test_spinoffs"
.         
.         // hypothesis: tenure overlap + strength of information 
.         *do "${analysis}/summary_tenureoverlap"
.         
. // ROBUSTNESS: RESULTS WITHOUT RECLASSIFICATIONS        
. 
.         // imposing restrictions and listing the events we want
.         *do "${analysis}/eventlist_noreclass"
.         
.         // organing exhibits before submission
.         *do "${analysis}/final_pred1_noreclass"
.         *do "${analysis}/final_pred2_noreclass"
.         *do "${analysis}/final_pred3_noreclass"
.         *do "${analysis}/final_pred4_noreclass"
.         *do "${analysis}/final_pred5_noreclass"
.         *do "${analysis}/final_pred6_noreclass"
.         *do "${analysis}/final_pred7_noreclass"
.         *do "${analysis}/final_alternatives_noreclass"
. 
. // ROBUSTNESS: TABLES WITH 0 RAIDES
. 
.         *do "${analysis}/final_pred4_zero"
.         *do "${analysis}/final_pred5_zero"
.         *do "${analysis}/final_alternatives_zero"
.         
.         *do "${analysis}/final_pred4_zeroonly"
.         *do "${analysis}/final_pred5_zeroonly"
.         *do "${analysis}/final_alternatives_zeroonly"
. 
. *-----------------------------------------*
. * ANALYSIS (202503 WORK) -- FABIANO'S STUFF
. *-----------------------------------------*
. 
. // MAIN ANALYSIS
. 
.         // imposing restrictions and listing the events we want
.         *do "${analysis}/eventlist"     
.         
.         // exhibits
.         *do "${analysis}/202503_sumstats"
.         *do "${analysis}/202503_pred1"
.         *do "${analysis}/202503_pred2"
.         *do "${analysis}/final_pred3"
.         *do "${analysis}/202503_pred4"
.         *do "${analysis}/202503_pred5"
.         *do "${analysis}/202503_pred6"
.         *do "${analysis}/final_pred7"
.         *do "${analysis}/final_alternatives"
.         
.         // other analyses
.         *do "${analysis}/final_preddelta"
.         
. // TESTING OTHER HYPOTHESES
. 
.         // hypothesis: managers are the owners of the destination firm (spino
> ffs)
.         *do "${analysis}/test_spinoffs"
.         
.         // hypothesis: tenure overlap + strength of information 
.         *do "${analysis}/summary_tenureoverlap"
.         
. // ROBUSTNESS: RESULTS WITHOUT RECLASSIFICATIONS        
. 
.         // imposing restrictions and listing the events we want
.         *do "${analysis}/eventlist_noreclass"
.         
.         // organing exhibits before submission
.         *do "${analysis}/final_pred1_noreclass"
.         *do "${analysis}/final_pred2_noreclass"
.         *do "${analysis}/final_pred3_noreclass"
.         *do "${analysis}/final_pred4_noreclass"
.         *do "${analysis}/final_pred5_noreclass"
.         *do "${analysis}/final_pred6_noreclass"
.         *do "${analysis}/final_pred7_noreclass"
.         *do "${analysis}/final_alternatives_noreclass"
. 
. // ROBUSTNESS: TABLES WITH 0 RAIDES
. 
.         *do "${analysis}/final_pred4_zero"
.         *do "${analysis}/final_pred5_zero"
.         *do "${analysis}/final_alternatives_zero"
.         
.         *do "${analysis}/final_pred4_zeroonly"
.         *do "${analysis}/final_pred5_zeroonly"
.         *do "${analysis}/final_alternatives_zeroonly"
. 
. 
. 
. 
. 
.         
. 
. 
. 
.         
. 
. *****************************************************************************
> **
. /* ARCHIVE
> 
> *--------------------------- mar 27 2025 archive ----------------------------
> ---
> 
>         // Figure 1: 
>         
>                 // baseline graph
>                 do "${analysis}/es_baseline"
>         
>                 // understanding baseline (raw averages)
>                 do "${analysis}/es_baseline_raw" // FD NOTE: I haven't organi
> zed this yet
>         
>         // Figure 2: 
>         
>                 // quality of new hires
>                 do "${analysis}/quality_dest_hire"
>         
>         // Table 1:
>         
>                 // summary statistics
>                 do "${analysis}/summary_statistics"
>         
>         // Table 2
>         
>                 // information available
>                 do "${analysis}/table2"
>                 
>         // Table 3
>         
>                 // information is needed
>                 do "${analysis}/table3"
>                 
>         // Destination growth
>         
>                 // # of hires and # total employess
>                 do "${analysis}/destgrowth"
>                 
>         // Trying something different: overlap between spv-spv and emp-emp
>         do "${analysis}/overlap"
>         
>         // Review why there are missing values
>         do "${auxiliary}/review_missing_variables"
>         
>         // Check if some variables are created correctly
>         do "${auxiliary}/vars_dont_look_right"
>         
>         // Check creation of variables for which we nly had the log
>         do "${auxiliary}/check_vars_in_levels"
> 
> *--------------------------- nov 19 2024 archive ----------------------------
> ---
> 
>         // Figure 3: 
>         
>                 // CDF quality at origin
>                 do "${analysis}/quality_origin"
>         
>                 // reg quality at origin
>                 do "${analysis}/reg_quality_origin"
>                 
>                 // generating CDF for subset of events that have at least 1 r
> aided worker and at least 1 moveable worker
>                 do "${analysis}/quality_origin_sel_evts"
>                 
>         // Table 2:
>         
>                 // v1
>                 do "${analysis}/table2"
>         
>                 // v2: include ind. and event time FE
>                 do "${analysis}/table2_v2"
> 
>         // Table 3:
>         
>                 // v1
>                 do "${analysis}/table3"
>         
>                 // v2: include ind. and event time FE
>                 do "${analysis}/table3_v2"
>                 
> *-------------------------- other archive -----------------------------------
> --
> 
> 
>         // firm-level event study: baseline figures with raw averages
>         *do "${analysis}/es_raw_firm"
>         
>         // firm-level event study: analysis using regressions
>         *do "${analysis}/es_reg_firm"
>         
>                 // heterogeneity: by type of movement (to dir, to spv, to emp
> )
>                 *do "${analysis}/es_reg_firm_type"
>                 
>                 // heterogeneity: by origin firm size
>                 *do "${analysis}/es_reg_firm_originsize"
>                 
>                 // heterogeneity: by destination firm size
>                 *do "${analysis}/es_reg_firm_destinationsize"
>                 
>                 // heterogeneity: by region (same or different)
>                 *do "${analysis}/es_reg_firm_region"
>         
>         // hires-level "event study" -- ?? -- tentative analysis so far 
>         *do "${analysis}/es_reg_hires"
>         
>         // table: wage regressions
>         
>                 // testing information hypothesis
>                 *do "${analysis}/reg_wage_info"         
> 
> *------------------------------ monthly rs ----------------------------------
> ---
> 
>         // prepare
> 
>                 // organizing full RAIS (monthly panel)
>                 do "programs/prepare/archive_20240708/rais_m_rs"
>                 
>                 // identifying poaching events
>                 do "programs/prepare/archive_20240708/evt_m_rs"
>                 
>                 // constructing worker-level data set with poaching events in
>  t=0
>                 do "programs/prepare/archive_20240708/evt_work_m_rs"
>                 
>                 // constructing worker-level panel with coworkers only
>                 do "programs/prepare/archive_20240708/cowork_panel_m_rs"
>                 
>                 // constructing event-level panel with poaching plants (d_pla
> nts)
>                 do "programs/prepare/archive_20240708/evt_panel_m_rs"
>                 
>                 // auxiliary data set: wages for coworkers
>                 do "programs/prepare/archive_20240708/wage_real_ln_cw"
>                 
>         // analysis
>         
>                 // sample selection (imposing additional criteria on the even
> ts)
>                 do "programs/analysis/archive_20240708/sample_selection"
> 
>                 // summary stats
>                 do "programs/analysis/archive_20240708/sumstats"
>         
>                 // firm-level event study
>                 do "programs/analysis/archive_20240708/es_firm_dir"
>         
>                 // wage distribution: before vs. after poaching
>                 do "programs/analysis/archive_20240708/wage_dist_dir"
>         
>                 // wage regression: poached workers only; correlation with "i
> nformation"
>                 do "programs/analysis/archive_20240708/wage_corrinfo_dir"
>         
>                 // wage regression: comparison with similar retained workers
>                 do "programs/analysis/archive_20240708/wage_xretained_dir"
> 
> 
> *------------------------------- quarterly ----------------------------------
> ---
> 
>         // organizing quarterly panel
>         do "programs/prepare/archive_20240430/RAIS_Quarterly_RS"
>         
>         // identifying poaching events
>         do "programs/prepare/archive_20240430/PoachingEvents_Quarterly_RS"
>         
>                 // Daniela's version
>                 do "programs/prepare/archive_20240430/evtdefine"
>         
>         // constructing the panel with coworkers
>         do "programs/prepare/archive_20240430/CoWorkers_Panel_Quarterly_RS"
>         
>                 // Daniela's version
>                 do "programs/prepare/archive_20240430/coworker_panel_q_rs"
>         
>         // creating the panel with poaching firms
>         do "programs/prepare/archive_20240430/PoachingEvents_Panel_Quarterly_
> RS"
>         
>                 // Daniela's version
>                 do "programs/prepare/archive_20240430/events_panel_rs" 
>                 

end of do-file
